#| label: load-packages
#| include: false
library(tidyverse)
library(palmerpenguins)
install.packages("palmerpenguins")
#| label: load-packages
#| include: false
library(tidyverse)
library(palmerpenguins)
library(ggthemes)
library(gt)
#| label: plot-penguins
#| warning: false
#| echo: false
#| fig-alt: |
#| A scatterplot of penguins' bill depth and length, colored by
#| species of penguins. There is a relatively strong, linear association.
ggplot(penguins,
aes(x = flipper_length_mm, y = bill_length_mm)) +
geom_point(aes(color = species, shape = species)) +
scale_color_manual(values = c("darkorange","purple","cyan4")) +
labs(
title = "Flipper and bill length",
subtitle = "Dimensions for penguins at Palmer Station LTER",
x = "Flipper length (mm)", y = "Bill length (mm)",
color = "Penguin species", shape = "Penguin species"
) +
theme_minimal()
install.packages("TinyTex")
install.packages("tinytex")
install.packages("textlive")
#remotes::install_github("walkerke/tidycensus")
library(tidyverse)
library(tidycensus)
#a = get_decennial(geography = "state", variables = "P1_001N", year = 2020)
# head(a, 5)
#install.packages("formattable")
library(formattable)
library(htmlwidgets)
library(leaflet)
library(sf)
library(formattable)
library(dplyr)
library(tidyr)
library(janitor)
#install.packages("leaflet.extras")
library(leaflet.extras)
library(googlesheets4)
googlesheets4::gs4_deauth()
smith <- read_sheet("https://docs.google.com/spreadsheets/d/1RheKDdtsToCcSLnZoZBYwtN_ISw6E2kgPIQpDQE_BYw/edit?usp=sharing") %>%
as.data.frame()
smith <- smith %>%
clean_names()
#join Community Statistical Area names
#associates neighborhood names to Census Tracts using Community Statistical Areas, 2010 https://bniajfi.org/mapping-resources/
#Baltimore has 56 neighborhoods as measured by Community Statistical Areas
csa <- read_csv("balt_census_crosswalks_2020.csv") %>%
rename(
geoid = GEOID_Tract_2020
) %>%
clean_names()
setwd("~/Code/Baltimore")
#join Community Statistical Area names
#associates neighborhood names to Census Tracts using Community Statistical Areas, 2010 https://bniajfi.org/mapping-resources/
#Baltimore has 56 neighborhoods as measured by Community Statistical Areas
csa <- read_csv("balt_census_crosswalks_2020.csv") %>%
rename(
geoid = GEOID_Tract_2020
) %>%
clean_names()
#join Community Statistical Area names
#associates neighborhood names to Census Tracts using Community Statistical Areas, 2010 https://bniajfi.org/mapping-resources/
#Baltimore has 56 neighborhoods as measured by Community Statistical Areas
csa <- read_csv("..\data\balt_census_crosswalks_2020.csv") %>%
#join Community Statistical Area names
#associates neighborhood names to Census Tracts using Community Statistical Areas, 2010 https://bniajfi.org/mapping-resources/
#Baltimore has 56 neighborhoods as measured by Community Statistical Areas
csa <- read_csv("../data/balt_census_crosswalks_2020.csv") %>%
rename(
geoid = GEOID_Tract_2020
) %>%
clean_names()
smith$tract <- as.character(smith$tract)
smith1 <- smith  %>%
right_join(csa, by=c("tract"="geoid")) %>%
distinct()
View(smith)
smith <- read.csv("../data/smith1_balt.csv")
x<- smith %>%
group_by(zip) %>%
count ()
sum(x$n)
googlesheets4::gs4_deauth()
smith <- read_sheet("https://docs.google.com/spreadsheets/d/1RheKDdtsToCcSLnZoZBYwtN_ISw6E2kgPIQpDQE_BYw/edit?usp=sharing") %>%
as.data.frame()
smith <- smith %>%
clean_names()
#join Community Statistical Area names
#associates neighborhood names to Census Tracts using Community Statistical Areas, 2010 https://bniajfi.org/mapping-resources/
#Baltimore has 56 neighborhoods as measured by Community Statistical Areas
csa <- read_csv("../data/balt_census_crosswalks_2020.csv") %>%
rename(
geoid = GEOID_Tract_2020
) %>%
clean_names()
#smith$tract <- as.character(smith$tract)
smith1 <- smith  %>%
right_join(csa, by=c("tract"="geoid")) %>%
distinct()
#Rename Columns
smith1<- smith1 %>%
rename(neighborhood = community_statistical_area_2020,
census = tract_2020)
#write.csv(smith1, "smith1_balt.csv")
smith <- read.csv("../data/smith1_balt.csv")
x<- smith %>%
group_by(zip) %>%
count ()
sum(x$n)
#per capita income seems way too low
median(smith$income_per_capita, na.rm = TRUE) #22653.77
median(smith$pct_anymembershp_zip, na.rm = TRUE) #0.455563
summary(smith$pct_anymembershp_zip, na.rm = TRUE)
median(smith$nbanks_zip, na.rm = TRUE) #5
summary(smith$nbanks_zip, na.rm = TRUE)
median(smith$census_response_rate2020, na.rm = TRUE) #0.564
summary(smith$census_response_rate2020, na.rm = TRUE)
#communities with greater than median membership - 46%- but less than median income - $22,790
smith %>%
group_by(neighborhood) %>%
select(pct_anymembershp_zip, income_per_capita) %>%
arrange(desc(pct_anymembershp_zip)) %>%
filter(pct_anymembershp_zip >= 0.455563) %>%
filter(income_per_capita <= 22789.76)
himember <- smith %>%
group_by(neighborhood) %>%
select(pct_anymembershp_zip, income_per_capita) %>%
arrange(desc(pct_anymembershp_zip)) %>%
filter(pct_anymembershp_zip >= 0.455563) %>%
filter(income_per_capita <= 22789.76)
View(himember)
View(smith)
#communities with greater than median membership - 46%- but less than median income - $22,790
himember <- smith %>%
group_by(neighborhood) %>%
select(pct_anymembershp_zip, income_per_capita, tract) %>%
arrange(desc(pct_anymembershp_zip)) %>%
filter(pct_anymembershp_zip >= 0.455563) %>%
filter(income_per_capita <= 22789.76)
View(himember)
md_income2020_geo <- get_acs(geography = "tract",
variables = c(number_households = "B19001_001", median_income = "B19013_001"),
state = "MD",
year = 2020, geometry = TRUE) %>%
mutate(year=("2020")) %>%
select(GEOID, NAME)
View(md_income2020_geo)
himember2 <- md_income2020_geo  %>%
right_join(himember, by=c("GEOID"="tract")) %>%
distinct()
himember <- himember %>%
mutate(GEOID = as.character(tract))
himember2 <- md_income2020_geo  %>%
right_join(himember, by=c("GEOID")) %>%
distinct()
View(himember)
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Change is:",(himember$pct_anymembershp_zip)), "for",himember$income_per_capita)) %>%
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Change is:",(himember$pct_anymembershp_zip), "for",himember$income_per_capita)) %>%
addLegend(
position = "bottomright",
pal = pal,
values = baltcity_income$diff_2020_2010,
title = "Median Income Change<br>Per Census Tract <br> 2010 to 2020"
)
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Change is:",(himember$pct_anymembershp_zip), "for",himember$income_per_capita)) %>%
addLegend(
position = "bottomright",
pal = pal,
values = himember$pct_anymembershp_zip,
title = "Median Income Change<br>Per Census Tract <br> 2010 to 2020"
)
saveWidget(leafMap, "leafMap.html")
leafMap
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(himember$pct_anymembershp_zip), "and income is",himember$income_per_capita)) %>%
addLegend(
position = "bottomright",
pal = pal,
values = himember$pct_anymembershp_zip,
title = "Median Income Change<br>Per Census Tract <br> 2010 to 2020"
)
saveWidget(leafMap, "leafMap.html")
leafMap
himember2$pct_anymembershp_zip <- formattable::percent(round(himember2$pct_anymembershp_zip, 2))
View(himember2)
himember2$pct_anymembershp_zip <- formattable::percent(himember2$pct_anymembershp_zip, 1)
himember2 <- md_income2020_geo  %>%
right_join(himember, by=c("GEOID")) %>%
distinct()
himember2$pct_anymembershp_zip <- formattable::percent(himember2$pct_anymembershp_zip, 1)
himember2$income_per_capita <- formattable::dollars(himember2$income_per_capita, 0)
himember2$income_per_capita <-
paste0('$', round(himember2$income_per_capita,0)))
himember2$income_per_capita <-
paste0('$', round(himember2$income_per_capita,0))
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(himember$pct_anymembershp_zip), "and income is",himember$income_per_capita)) %>%
addLegend(
position = "bottomright",
pal = pal,
values = himember$pct_anymembershp_zip,
title = "Median Income Change<br>Per Census Tract <br> 2010 to 2020"
)
saveWidget(leafMap, "leafMap.html")
leafMap
View(himember2)
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(himember$pct_anymembershp_zip), "and income is",himember$income_per_capita)) %>%
addLegend(
position = "bottomright",
pal = pal,
values = himember$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
)
saveWidget(leafMap, "leafMap.html")
leafMap
View(himember2)
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(himember2$pct_anymembershp_zip), "and income is",himember2$income_per_capita)) %>%
addLegend(
position = "bottomright",
pal = pal,
values = himember2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
)
saveWidget(leafMap, "leafMap.html")
leafMap
View(himember2)
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(himember2$pct_anymembershp_zip), "and income is",himember2$income_per_capita), "in" himember2$neighborhood) %>%
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(himember2$pct_anymembershp_zip), "and income is",himember2$income_per_capita), "in", himember2$neighborhood) %>%
addLegend(
position = "bottomright",
pal = pal,
values = himember2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
)
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(himember2$pct_anymembershp_zip), "and income is",(himember2$income_per_capita), "in", (himember2$neighborhood)) %>%
addLegend(
position = "bottomright",
pal = pal,
values = himember2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
)
saveWidget(leafMap, "leafMap.html")
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",himember2$pct_anymembershp_zip), "and income is",himember2$income_per_capita), "in", (himember2$neighborhood)) %>%
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(himember2$pct_anymembershp_zip), "and income is",himember2$income_per_capita), "in", (himember2$neighborhood)) %>%
addLegend(
position = "bottomright",
pal = pal,
values = himember2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
)
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(himember2$pct_anymembershp_zip), "and income is",(himember2$income_per_capita), "in", (himember2$neighborhood))) %>%
addLegend(
position = "bottomright",
pal = pal,
values = himember2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
)
saveWidget(leafMap, "leafMap.html")
leafMap
#Map by Median Income Difference
baltcity_income <- baltcity_income %>%
sf::st_transform('+proj=longlat +datum=WGS84')
#Map by Median Income Difference
himember2 <- himember2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = himember2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = himember2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(himember2$pct_anymembershp_zip), "and income is",(himember2$income_per_capita), "in", (himember2$neighborhood))) %>%
addLegend(
position = "bottomright",
pal = pal,
values = himember2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
)
saveWidget(leafMap, "../output/membership_map_dec_18.html")
leafMap
saveWidget(leafMap, "../membership_map_dec_18.html")
